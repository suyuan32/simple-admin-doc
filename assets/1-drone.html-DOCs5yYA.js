import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as s,o as t,c as o,a as n,b as i,e as r}from"./app-iw6MeW5y.js";const p={},c=n("h2",{id:"drone-ci-files-generating",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#drone-ci-files-generating"},[n("span",null,"Drone CI Files Generating")])],-1),l={class:"hint-container info"},d=n("p",{class:"hint-container-title"},"Video tutorial",-1),u=r(`<h2 id="create-drone-ci-file" tabindex="-1"><a class="header-anchor" href="#create-drone-ci-file"><span>Create Drone CI file</span></a></h2><blockquote><p>Create .drone.yaml and Dockerfile files</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>goctls cicd drone <span class="token parameter variable">-d</span><span class="token operator">=</span><span class="token string">&quot;core&quot;</span> <span class="token parameter variable">-g</span><span class="token operator">=</span><span class="token string">&quot;gitee.com&quot;</span> <span class="token parameter variable">-s</span><span class="token operator">=</span><span class="token string">&quot;core&quot;</span> <span class="token parameter variable">-x</span><span class="token operator">=</span><span class="token string">&quot;rpc&quot;</span> <span class="token parameter variable">-b</span><span class="token operator">=</span><span class="token string">&quot;master&quot;</span> <span class="token parameter variable">-r</span><span class="token operator">=</span><span class="token string">&quot;registry.cn-beijing.aliyuncs.com&quot;</span> <span class="token parameter variable">-o</span><span class="token operator">=</span><span class="token string">&quot;registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker:v1.1.0&quot;</span> <span class="token parameter variable">-e</span><span class="token operator">=</span><span class="token string">&quot;core&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>repo parameter For latest: -o=&quot;registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker&quot; For non-latest: -o=&quot;registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker:v1.1.0&quot;</p></div><h3 id="introduction-to-cicd-drone-parameters" tabindex="-1"><a class="header-anchor" href="#introduction-to-cicd-drone-parameters"><span>Introduction to <code>cicd drone</code> parameters</span></a></h3><table><thead><tr><th>Parameter</th><th>Required</th><th>Default Value</th><th>Description</th><th>Usage</th></tr></thead><tbody><tr><td>drone_name</td><td>No</td><td>drone-greet</td><td>Drone name</td><td>Customize a name for drone</td></tr><tr><td>go_private</td><td>Yes</td><td>gitee.com</td><td>Go private repository settings</td><td>For example: gitee.com | github.com</td></tr><tr><td>service_name</td><td>Yes</td><td>None</td><td>Go-zero service main program entry file</td><td>For example: core.go, the suffix .go must be omitted</td></tr><tr><td>service_type</td><td>No</td><td>happy</td><td>Go-zero service type</td><td>For example: rpc | api</td></tr><tr><td>git_branch</td><td>No</td><td>main</td><td>Git repository branch</td><td>Depending on your own git branch</td></tr><tr><td>registry</td><td>Yes</td><td>None</td><td>Remote image repository address</td><td>For example, Alibaba Cloud mirror address: registry.cn-beijing.aliyuncs.com</td></tr><tr><td>repo</td><td>Yes</td><td>None</td><td>Remote image repository address</td><td>If the tag is not &#39;latest&#39;, it needs to be specified, for example: git-repo:v0.0.1, if it is &#39;latest&#39;, it needs to be ignored</td></tr><tr><td>etc_yaml</td><td>Yes</td><td>None</td><td>Dockerfile configuration used by drone in the CI process</td><td>The yaml configuration file name under the etc folder of the go-zero project</td></tr></tbody></table><p><strong>For detailed parameters, use <code>goctls cicd drone -h</code> in the command line</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ goctls cicd drone <span class="token parameter variable">-h</span>
Generate Drone yaml and Dockerfile

Usage:
  goctls cicd drone <span class="token punctuation">[</span>flags<span class="token punctuation">]</span>

Flags:
  -d, <span class="token parameter variable">--drone_name</span> string     The Drone name
  -e, <span class="token parameter variable">--etc_yaml</span> string       The Dockerfile with drone used, go-zero project etc yaml <span class="token function">file</span> name <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -b, <span class="token parameter variable">--git_branch</span> string     The branch of the remote repo, default <span class="token string">&quot;main&quot;</span>  <span class="token punctuation">(</span>default <span class="token string">&quot;master&quot;</span><span class="token punctuation">)</span>
  -g, <span class="token parameter variable">--go_private</span> string     Go private such as: gitee.com<span class="token operator">|</span>github.com, default <span class="token string">&quot;gitee.com&quot;</span> <span class="token punctuation">(</span>required<span class="token punctuation">)</span> <span class="token punctuation">(</span>default <span class="token string">&quot;gitee.com&quot;</span><span class="token punctuation">)</span>
  -h, <span class="token parameter variable">--help</span>                  <span class="token builtin class-name">help</span> <span class="token keyword">for</span> drone
  -r, <span class="token parameter variable">--registry</span> string       The remote Docker Registry, <span class="token keyword">if</span> aliyun ACR such as: registry.cn-beijing.aliyuncs.com <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -o, <span class="token parameter variable">--repo</span> string           The remote Git Repository, <span class="token keyword">if</span> tag is not <span class="token string">&#39;latest&#39;</span> please assign tag such as: git-repo:v0.0.1, <span class="token keyword">if</span> tag is latest you can ignore the tag <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -s, <span class="token parameter variable">--service_name</span> string   The <span class="token function">service</span> name of the main project go file, such as: core.go, you must ignore suffix: .go  <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -x, <span class="token parameter variable">--service_type</span> string   The <span class="token function">service</span> <span class="token builtin class-name">type</span> such as: rpc<span class="token operator">|</span>api, default <span class="token string">&quot;happy&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>You can see the following structure <br> Note: The .drone.yml file generated in the Mac environment is hidden by default and requires the command <code>Command + Shift + .</code> to be visible.</p></blockquote><img width="298" alt="image" src="https://github.com/suyuan32/simple-admin-doc/assets/5540291/ff0ee451-bccd-4783-a92c-2a59f1a834a7"><h3 id="file-structure" tabindex="-1"><a class="header-anchor" href="#file-structure"><span>File Structure</span></a></h3><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>├── example                           go-zero project
├── .drone.yml                        configuration file directory
└── Dockerfile                        Dockerfile configuration file
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>.drone.yml <br> docker_username and docker_password in the yml file are the account and password of the repository configured in drone for pulling private images.</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">type</span><span class="token punctuation">:</span> docker
<span class="token key atrule">name</span><span class="token punctuation">:</span> core<span class="token punctuation">-</span>rpc
<span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> build<span class="token punctuation">-</span>go
    <span class="token key atrule">image</span><span class="token punctuation">:</span> golang<span class="token punctuation">:</span>1.20.3
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>clone<span class="token punctuation">]</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> go_cache
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /go/pkg/mod
    <span class="token key atrule">commands</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> go env <span class="token punctuation">-</span>w CGO_ENABLED=0
      <span class="token punctuation">-</span> go env <span class="token punctuation">-</span>w GOPROXY=https<span class="token punctuation">:</span>//goproxy.cn<span class="token punctuation">,</span>direct
      <span class="token punctuation">-</span> go env <span class="token punctuation">-</span>w GOPRIVATE=gitee.com
      <span class="token punctuation">-</span> go mod tidy <span class="token important">&amp;&amp;</span> go build <span class="token punctuation">-</span>trimpath <span class="token punctuation">-</span>ldflags &quot;<span class="token punctuation">-</span>s <span class="token punctuation">-</span>w&quot; <span class="token punctuation">-</span>o app core.go

  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> build<span class="token punctuation">-</span>rpc
    <span class="token key atrule">image</span><span class="token punctuation">:</span> plugins/docker<span class="token punctuation">:</span><span class="token number">20</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">DRONE_REPO_BRANCH</span><span class="token punctuation">:</span> master
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>build<span class="token punctuation">-</span>go<span class="token punctuation">]</span>
    <span class="token key atrule">settings</span><span class="token punctuation">:</span>
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile
      <span class="token key atrule">registry</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>beijing.aliyuncs.com
      <span class="token key atrule">repo</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/simple_admin/core<span class="token punctuation">-</span>api<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.1.0
      <span class="token key atrule">auto_tag</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">insecure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span>
        <span class="token key atrule">from_secret</span><span class="token punctuation">:</span> docker_username
      <span class="token key atrule">password</span><span class="token punctuation">:</span>
        <span class="token key atrule">from_secret</span><span class="token punctuation">:</span> docker_password
<span class="token key atrule">trigger</span><span class="token punctuation">:</span>
  <span class="token key atrule">ref</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> refs/tags/*
    <span class="token punctuation">-</span> refs/heads/master

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> go_cache
    <span class="token key atrule">host</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /root/.go/cache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Dockerfile</p></blockquote><div class="language-Dockefile line-numbers-mode" data-ext="Dockefile" data-title="Dockefile"><pre class="language-Dockefile"><code>FROM alpine

RUN apk update &amp;&amp; apk add tzdata
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

COPY ./app /app/
COPY ./etc/core.yaml /app/etc/core.yaml
workdir /app/
ENTRYPOINT [&quot;./app&quot;]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16);function m(k,v){const a=s("BiliBili");return t(),o("div",null,[c,n("div",l,[d,i(a,{bvid:"BV1ZN411b7sp"})]),u])}const h=e(p,[["render",m],["__file","1-drone.html.vue"]]),y=JSON.parse('{"path":"/guide/cicd/1-drone.html","title":"Drone CI","lang":"en-US","frontmatter":{"order":1,"title":"Drone CI","description":"Drone CI Files Generating Video tutorial Create Drone CI file Create .drone.yaml and Dockerfile files Warning repo parameter For latest: -o=\\"registry.cn-hangzhou.aliyuncs.com/si...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://doc.ryansu.tech/zh/guide/cicd/1-drone.html"}],["meta",{"property":"og:url","content":"https://doc.ryansu.tech/guide/cicd/1-drone.html"}],["meta",{"property":"og:site_name","content":"Simple Admin"}],["meta",{"property":"og:title","content":"Drone CI"}],["meta",{"property":"og:description","content":"Drone CI Files Generating Video tutorial Create Drone CI file Create .drone.yaml and Dockerfile files Warning repo parameter For latest: -o=\\"registry.cn-hangzhou.aliyuncs.com/si..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-15T10:08:11.000Z"}],["meta",{"property":"article:author","content":"Ryan SU"}],["meta",{"property":"article:modified_time","content":"2024-05-15T10:08:11.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Drone CI\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-15T10:08:11.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Ryan SU\\",\\"url\\":\\"https://github.com/suyuan32\\"}]}"]]},"headers":[{"level":2,"title":"Drone CI Files Generating","slug":"drone-ci-files-generating","link":"#drone-ci-files-generating","children":[]},{"level":2,"title":"Create Drone CI file","slug":"create-drone-ci-file","link":"#create-drone-ci-file","children":[{"level":3,"title":"Introduction to cicd drone parameters","slug":"introduction-to-cicd-drone-parameters","link":"#introduction-to-cicd-drone-parameters","children":[]},{"level":3,"title":"File Structure","slug":"file-structure","link":"#file-structure","children":[]}]}],"git":{"createdTime":1691031420000,"updatedTime":1715767691000,"contributors":[{"name":"Ryan SU","email":"yuansu.china.work@gmail.com","commits":3},{"name":"Ryan Su","email":"yuansu.china.work@gmail.com","commits":1}]},"readingTime":{"minutes":1.94,"words":581},"filePathRelative":"guide/cicd/1-drone.md","localizedDate":"August 3, 2023","autoDesc":true,"excerpt":"<h2>Drone CI Files Generating</h2>\\n<div class=\\"hint-container info\\">\\n<p class=\\"hint-container-title\\">Video tutorial</p>\\n</div>\\n<h2>Create Drone CI file</h2>\\n<blockquote>\\n<p>Create .drone.yaml and Dockerfile files</p>\\n</blockquote>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code>goctls cicd drone <span class=\\"token parameter variable\\">-d</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"core\\"</span> <span class=\\"token parameter variable\\">-g</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"gitee.com\\"</span> <span class=\\"token parameter variable\\">-s</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"core\\"</span> <span class=\\"token parameter variable\\">-x</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"rpc\\"</span> <span class=\\"token parameter variable\\">-b</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"master\\"</span> <span class=\\"token parameter variable\\">-r</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"registry.cn-beijing.aliyuncs.com\\"</span> <span class=\\"token parameter variable\\">-o</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker:v1.1.0\\"</span> <span class=\\"token parameter variable\\">-e</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"core\\"</span>\\n</code></pre></div>"}');export{h as comp,y as data};
