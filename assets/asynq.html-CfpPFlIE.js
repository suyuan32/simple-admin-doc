import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,o as n,b as i}from"./app-DEAdWuUi.js";const l={},e=i(`<h2 id="how-to-use-asynq-as-a-message-queue-in-rpc" tabindex="-1"><a class="header-anchor" href="#how-to-use-asynq-as-a-message-queue-in-rpc"><span>How to use Asynq as a message queue in RPC?</span></a></h2><div class="hint-container info"><p class="hint-container-title">Official Document</p><p><a href="https://github.com/hibiken/asynq/wiki" target="_blank" rel="noopener noreferrer">Document</a></p></div><h3 id="add-asynq-configuration-information" tabindex="-1"><a class="header-anchor" href="#add-asynq-configuration-information"><span>Add Asynq configuration information</span></a></h3><p><code>etc</code></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#22863A;--shiki-dark:#E06C75;">AsynqConf</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"># if you do not use WithRedisConf, you should uncomment the configuration below</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">#  Addr: localhost:6379  # Redis address</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">#  Pass: # Redis Password</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">#  DB: 0 # Redis database index</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">#  Concurrency: 20 # max concurrent process job task num</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">#  SyncInterval: 10 # seconds, this field specifies how often sync should happen</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#E06C75;">  Enable</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#005CC5;--shiki-dark:#D19A66;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="add-configuration-to-config" tabindex="-1"><a class="header-anchor" href="#add-configuration-to-config"><span>Add configuration to <code>config</code></span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">package</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-common/plugins/casbin</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-common/plugins/mq/asynq</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/zeromicro/go-zero/core/stores/redis</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/zeromicro/go-zero/zrpc</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-common/config</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">type</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> Config</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> struct</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#E5C07B;">	zrpc</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">RpcServerConf</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	DatabaseConf</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> config</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">DatabaseConf</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	CasbinConf</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">   casbin</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">CasbinConf</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	RedisConf</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">    redis</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">RedisConf</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	AsynqConf</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">    asynq</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">AsynqConf</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="initialize-service-context" tabindex="-1"><a class="header-anchor" href="#initialize-service-context"><span>Initialize <code>service_context</code></span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">package</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> svc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/hibiken/asynq</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-core/rpc/ent</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-core/rpc/internal/config</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/zeromicro/go-zero/core/logx</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/zeromicro/go-zero/core/stores/redis</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">type</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> ServiceContext</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> struct</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	Config</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">     config</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Config</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	DB</span><span style="color:#D73A49;--shiki-dark:#C678DD;">         *</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ent</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Client</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	Redis</span><span style="color:#D73A49;--shiki-dark:#C678DD;">      *</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">redis</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Redis</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	MQProducer</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">asynq</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Client</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> NewServiceContext</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">c</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> config</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Config</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">*</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ServiceContext</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	db</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#24292E;--shiki-dark:#E06C75;"> ent</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">NewClient</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		ent</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Log</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">logx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">Info</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">// logger</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		ent</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Driver</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">c</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">DatabaseConf</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">NewNoCacheDriver</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		ent</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Debug</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">// debug mode</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">	return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> &amp;</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ServiceContext</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		Config</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:     </span><span style="color:#24292E;--shiki-dark:#E06C75;">c</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		DB</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:         </span><span style="color:#24292E;--shiki-dark:#E06C75;">db</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		Redis</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:      </span><span style="color:#24292E;--shiki-dark:#E06C75;">redis</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">MustNewRedis</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">c</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">RedisConf</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		MQProducer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">asynq</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">NewClient</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">c</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">AsynqConf</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">WithRedisConf</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">c</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">RedisConf</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">NewRedisOpt</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="use-client" tabindex="-1"><a class="header-anchor" href="#use-client"><span>Use Client</span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">package</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> api</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">context</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/hibiken/asynq</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-core/rpc/internal/svc</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-core/rpc/internal/utils/errorhandler</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-core/rpc/types/core</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/zeromicro/go-zero/core/logx</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379;">	&quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">github.com/suyuan32/simple-admin-common/i18n</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">type</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> CreateApiLogic</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> struct</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	ctx</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">    context</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Context</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	svcCtx</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">svc</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ServiceContext</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#E5C07B;">	logx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Logger</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> NewCreateApiLogic</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">ctx</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> context</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Context</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">svcCtx</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">svc</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ServiceContext</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">*</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">CreateApiLogic</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">	return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> &amp;</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">CreateApiLogic</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		ctx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:    </span><span style="color:#24292E;--shiki-dark:#E06C75;">ctx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		svcCtx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">svcCtx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		Logger</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">logx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">WithContext</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">ctx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">l </span><span style="color:#D73A49;--shiki-dark:#C678DD;">*</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">CreateApiLogic</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">CreateApi</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">in</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">core</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ApiInfo</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) (</span><span style="color:#D73A49;--shiki-dark:#C678DD;">*</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">core</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">BaseIDResp</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#D73A49;--shiki-dark:#C678DD;">error</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	result</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">err</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#24292E;--shiki-dark:#E06C75;"> l</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">svcCtx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">DB</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">API</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Create</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">().</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">		SetPath</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">in</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">Path</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">		SetDescription</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">in</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">Description</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">		SetAPIGroup</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">in</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">ApiGroup</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">		SetMethod</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">in</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">Method</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">).</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">		Save</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">l</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">ctx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">	if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> err</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> nil</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">		return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> nil</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">errorhandler</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">DefaultEntError</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">l</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">Logger</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">err</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">in</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	task</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#24292E;--shiki-dark:#E06C75;"> asynq</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">NewTask</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;hello_world&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, []</span><span style="color:#D73A49;--shiki-dark:#C678DD;">byte</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;{</span><span style="color:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="color:#032F62;--shiki-dark:#98C379;">name</span><span style="color:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="color:#032F62;--shiki-dark:#98C379;">:</span><span style="color:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="color:#032F62;--shiki-dark:#98C379;">api test</span><span style="color:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="color:#032F62;--shiki-dark:#98C379;">}&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	_</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">err</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> =</span><span style="color:#24292E;--shiki-dark:#E06C75;"> l</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">svcCtx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">MQProducer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Enqueue</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">task</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">	if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> err</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> nil</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">		return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> nil</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">err</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">	return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> &amp;</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">core</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">BaseIDResp</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">{</span><span style="color:#24292E;--shiki-dark:#E06C75;">Id</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">result</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">ID</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">Msg</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">i18n</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">CreateSuccess</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">nil</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="delay-message-queue" tabindex="-1"><a class="header-anchor" href="#delay-message-queue"><span>Delay Message Queue</span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">_</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">err</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> =</span><span style="color:#24292E;--shiki-dark:#E06C75;"> l</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">svcCtx</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">MQProducer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Enqueue</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">task</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">asynq</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">ProcessIn</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">24</span><span style="color:#D73A49;--shiki-dark:#C678DD;">*</span><span style="color:#24292E;--shiki-dark:#E06C75;">time</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">Hour</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,13),o=[e];function r(p,t){return n(),a("div",null,o)}const d=s(l,[["render",r],["__file","asynq.html.vue"]]),h=JSON.parse('{"path":"/guide/feature/MQ/asynq.html","title":"Asynq Message Queue","lang":"en-US","frontmatter":{"order":1,"title":"Asynq Message Queue","head":[["meta",{"name":"keywords","content":"asynq, message queue, light weight, simple admin job, scheduler"}],["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://doc.ryansu.tech/zh/guide/feature/MQ/asynq.html"}],["meta",{"property":"og:url","content":"https://doc.ryansu.tech/guide/feature/MQ/asynq.html"}],["meta",{"property":"og:site_name","content":"Simple Admin"}],["meta",{"property":"og:title","content":"Asynq Message Queue"}],["meta",{"property":"og:description","content":"How to use Asynq as a message queue in RPC? Official Document Document Add Asynq configuration information etc Add configuration to config Initialize service_context Use Client ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-20T10:41:28.000Z"}],["meta",{"property":"article:author","content":"Ryan SU"}],["meta",{"property":"article:modified_time","content":"2024-05-20T10:41:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Asynq Message Queue\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-20T10:41:28.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Ryan SU\\",\\"url\\":\\"https://github.com/suyuan32\\"}]}"]],"description":"How to use Asynq as a message queue in RPC? Official Document Document Add Asynq configuration information etc Add configuration to config Initialize service_context Use Client ..."},"headers":[{"level":2,"title":"How to use Asynq as a message queue in RPC?","slug":"how-to-use-asynq-as-a-message-queue-in-rpc","link":"#how-to-use-asynq-as-a-message-queue-in-rpc","children":[{"level":3,"title":"Add Asynq configuration information","slug":"add-asynq-configuration-information","link":"#add-asynq-configuration-information","children":[]},{"level":3,"title":"Add configuration to config","slug":"add-configuration-to-config","link":"#add-configuration-to-config","children":[]},{"level":3,"title":"Initialize service_context","slug":"initialize-service-context","link":"#initialize-service-context","children":[]},{"level":3,"title":"Use Client","slug":"use-client","link":"#use-client","children":[]},{"level":3,"title":"Delay Message Queue","slug":"delay-message-queue","link":"#delay-message-queue","children":[]}]}],"git":{"createdTime":1678848582000,"updatedTime":1716201688000,"contributors":[{"name":"Ryan SU","email":"1137661202@qq.com","commits":1},{"name":"Ryan Su","email":"yuansu.china.work@gmail.com","commits":1}]},"readingTime":{"minutes":0.99,"words":297},"filePathRelative":"guide/feature/MQ/asynq.md","localizedDate":"March 15, 2023","autoDesc":true,"excerpt":"<h2>How to use Asynq as a message queue in RPC?</h2>\\n<div class=\\"hint-container info\\">\\n<p class=\\"hint-container-title\\">Official Document</p>\\n<p><a href=\\"https://github.com/hibiken/asynq/wiki\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Document</a></p>\\n</div>\\n<h3>Add Asynq configuration information</h3>"}');export{d as comp,h as data};
